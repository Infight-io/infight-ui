import axios from 'axios';
import { useSessionStore } from '../stores/SessionStore'

export default {
    install: (app, options) => {

        const store = useSessionStore()
        const apiRoot = app.config.globalProperties.$apiHostname

        app.config.globalProperties.$api = {
            getMyGames: async function () {
                return await axios({
                    url: apiRoot + '/myTeams',
                    headers: { 'Authorization': store.jwt }
                })
            },
            createGame: async function (teamId, cycleHours, boardSize) {
                return await axios({
                    url: apiRoot + '/games/' + teamId + '/new',
                    method: 'post',
                    headers: { 'Authorization': store.jwt },
                    data: {
                        cycleHours: cycleHours,
                        boardSize: boardSize
                    }
                })
            },
            getGame: async function (teamId, gameId) {
                return await axios({
                    url: apiRoot + '/games/' + teamId + '/' + gameId,
                    method: 'get'
                })
            },
            tickGame: async function (teamId, gameId) {
                return await axios({
                    url: apiRoot + '/games/' + teamId + '/' + gameId + '/tick',
                    method: 'post'
                })
            },
            deleteGame: async function (teamId, gameId) {
                return await axios({
                    url: apiRoot + '/games/' + teamId + '/' + gameId,
                    method: 'delete'
                })
            },
            startGame: async function (teamId, gameId) {
                return await axios({
                    url: apiRoot + '/games/' + teamId + '/' + gameId + '/start',
                    method: 'post'
                })
            },
            actInGame: async function (teamId, gameId, action, targetX, targetY) {
                return await axios({
                    url: apiRoot + '/games/' + teamId + '/' + gameId + '/act',
                    method: 'post',
                    headers: { 'Authorization': store.jwt },
                    data: {
                        action: action,
                        targetX: targetX,
                        targetY: targetY
                    }
                })
            }
        }

    }
}